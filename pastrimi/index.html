<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>PASTRIMI • Proces</title>
  <style>
    :root{
      --bg:#070a12; --ink:#eaf1ff; --muted:#9fb0cc;
      --panel:#0c0f16; --edge:#273143; --chip:#0b111d; --chipBr:#2c3a55;
      --good:#1ea55b; --warn:#e6a400; --bad:#e14b4b; --btn:#1e60ff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);
      font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    a{color:#cfe2ff;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:14px 16px 100px}
    .top{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
    .title{font-size:clamp(30px,6vw,44px);font-weight:1000;letter-spacing:.02em}
    .nav{display:flex;gap:10px;flex-wrap:wrap}
    .nav a{padding:8px 12px;border-radius:999px;border:1px solid var(--edge);background:#0a1220;font-weight:900}
    .nav a.active{background:#15223b}
    #stats{margin:12px 0}
    .pill{background:var(--chip);border:1px solid var(--edge);border-radius:12px;
      padding:10px 12px;font-weight:1000;display:inline-flex;align-items:center;gap:8px}
    .row{display:flex;flex-wrap:wrap;gap:10px}
    .card{border:1px solid var(--edge);background:var(--panel);border-radius:14px;padding:10px;margin:10px 0}
    .head{display:grid;grid-template-columns:auto 1fr auto auto auto auto 12px;
      gap:8px;align-items:center}
    .code{font-weight:1000;background:#0b111d;border:1px solid var(--edge);border-radius:999px;padding:6px 10px;cursor:pointer}
    .name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .badge{background:#0b111d;border:1px solid var(--chipBr);border-radius:999px;padding:6px 10px;font-weight:900}
    .age{width:10px;height:10px;border-radius:50%}
    .age.good{background:var(--good)} .age.warn{background:var(--warn)} .age.bad{background:var(--bad)}
    .actions{display:flex;gap:8px;margin-top:8px}
    .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:1000;background:#0c1220;color:#e6f0ff;border:1px solid #2b3956}
    .btn.primary{background:var(--btn)}
    #stageSheet{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:9998;align-items:center;justify-content:center;padding:16px}
    #stageSheet .box{background:#0c0f16;border:1px solid var(--edge);border-radius:16px;padding:12px;max-width:520px;width:100%}
    #stageSheet .chips{display:flex;flex-wrap:wrap;gap:10px}
    #stageSheet .chip{background:var(--chip);border:1px solid var(--chipBr);border-radius:999px;padding:10px 14px;font-weight:900}
    #sb_err{position:fixed;right:12px;bottom:12px;display:none}
    .ms-link{display:none!important}
  </style>

  <!-- shared panel JS (safe to keep) -->
  <script type="module" src="/assets/client.panel.js"></script>
</head>
<body>
  <div id="topbar-nav" style="position:sticky;top:0;z-index:50;background:var(--bg,#000);border-bottom:1px solid #273143;padding:6px 10px;display:flex;gap:8px;justify-content:flex-end;align-items:center"></div>

  <div class="wrap">
    <div class="top">
      <div class="title">PASTRIMI</div>
      <nav class="nav">
        <a href="/">HOME</a>
        <a href="/pranimi/">PRANIMI</a>
        <a href="/pastrimi/" class="active">PASTRIMI</a>
        <a href="/gati/">GATI</a>
        <a href="/arka/">ARKA</a>
      </nav>
    </div>

    <div id="stats"></div>
    <div id="list"></div>
  </div>

  <!-- Stage picker (long-press) -->
  <div id="stageSheet">
    <div class="box">
      <div style="font-weight:1000;margin-bottom:10px">Zgjidh fazën</div>
      <div id="stageBtns" class="chips">
        <button class="chip">RADHË</button>
        <button class="chip">LAJ</button>
        <button class="chip">THAJ</button>
        <button class="chip">PAKO</button>
      </div>
      <div style="display:flex;justify-content:flex-end;margin-top:10px">
        <button id="stageCancel" class="chip">Mbyll</button>
      </div>
    </div>
  </div>

  <!-- data + list renderer -->
  <script type="module" src="/assets/supabase.js"></script>
  <script type="module" src="/assets/pastrimi.js?v=4"></script>
  <script src="/assets/payment.panel.js"></script>
  <script src="/assets/client.template.js"></script>
  <script src="/assets/search.panel.js"></script>

  <!-- CLICK HANDLER: open PRANIMI with SAME code + order id -->
  <script>
  (function () {
    function extractCodeFrom(el){
      var c = (el && el.dataset && el.dataset.code) ? el.dataset.code : '';
      if(!c){
        var m = (el && el.textContent ? el.textContent : '').match(/\d+/);
        c = m ? m[0] : '';
      }
      return (c||'').replace(/^[-–—\s]+/,'').trim();
    }
    function go(id, code){
      if(!code) return;
      window.location.href =
        '/pranimi/?id=' + encodeURIComponent(id||'') +
        '&code=' + encodeURIComponent(code);
    }
    document.addEventListener('click', function(e){
      var t = e.target; if(!t) return;
      var hit = t.closest && t.closest('[data-order-id], [data-code], .code, .kodi, .code-badge');
      if(!hit) return;

      var row  = hit.closest && hit.closest('[data-order-id]');
      var id   = row && row.dataset ? row.dataset.orderId : (hit.dataset ? hit.dataset.orderId : '');
      var code = (hit.dataset && hit.dataset.code) ? hit.dataset.code : extractCodeFrom(hit);

      if(code){
        e.preventDefault(); e.stopPropagation();
        go(id, code);
      }
    }, true);
  })();
  </script>
  <script src="/assets/repair.normalize.js"></script>
<script src="/assets/pastrimi.load.rpc.js?v=rpc1"></script>

<script>
(function(){
  function onRowClick(e){
    const row = e.currentTarget;
    const id = row.getAttribute('data-id');
    const code = row.getAttribute('data-code');
    if(id) location.href = '../client_profile.html?id='+encodeURIComponent(id);
    else if(code) location.href = '../client_profile.html?code='+encodeURIComponent(code);
  }
  // Attach to any element with class 'order-row' or data-id/data-code
  function bind(){
    document.querySelectorAll('.order-row,[data-id],[data-code]').forEach(el=>{
      if(el.__bound) return;
      el.__bound = true;
      el.addEventListener('click', onRowClick);
    });
  }
  document.addEventListener('DOMContentLoaded', bind);
  setInterval(bind, 800); // in case rows are rendered later
})();
</script>
</body>
</html>