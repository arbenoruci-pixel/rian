
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MOZULUK • Lead Finder PRO</title>
<meta name="theme-color" content="#0b0f14">
<style>
  :root {
    --bg: #0b0f14; --panel:#121821; --muted:#7c8da6; --text:#e7eefc; --accent:#3aa0ff;
    --good:#41d27d; --warn:#ffb020; --bad:#ff5d5d; --pill:#1c2532; --border:#202a36;
  }
  *{box-sizing:border-box} html,body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0}
  .brand{text-align:center;margin-top:18px;letter-spacing:2px;font-weight:900;color:var(--accent);font-size:1.6rem}
  h1{text-align:center;font-size:1.25rem;margin:6px 0 8px;letter-spacing:.04em}
  .sub{text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:16px}
  .wrap{max-width:1100px;margin:0 auto;padding:12px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:900px){ .two{grid-template-columns:1fr} }
  label{font-size:.78rem;color:var(--muted);display:block;margin-bottom:6px}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--pill);color:var(--text);font-size:.95rem;outline:none}
  textarea{min-height:90px;resize:vertical}
  .btn{background:var(--accent);color:#02101f;border:none;border-radius:10px;padding:11px 14px;font-weight:700;cursor:pointer;letter-spacing:.03em}
  .btn.secondary{background:#182233;color:var(--text);border:1px solid var(--border)}
  .btn.ghost{background:transparent;color:var(--text);border:1px dashed var(--border)}
  .pill{background:var(--pill);padding:6px 10px;border-radius:999px;display:inline-block;font-size:.8rem;color:var(--muted);border:1px solid var(--border)}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left;vertical-align:top}
  th{color:var(--muted);font-weight:600;font-size:.85rem}
  td a{color:var(--accent);text-decoration:none}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .small{font-size:.85rem}
  .footer{text-align:center;color:var(--muted);margin-top:16px;font-size:.8rem}
  .status{font-size:.85rem;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
  <div class="brand">MOZULUK</div>
  <h1>LEAD FINDER PRO — Freight Forwarders (US)</h1>
  <div class="sub">Auto-search targeted prospects (FF/NVOCC/IATA). Use <b>SerpAPI</b> key for in-app results, or fallback opens tabs.</div>

  <div class="wrap">
    <div class="card">
      <div class="two">
        <div>
          <label>Regions (comma-separated)</label>
          <input id="regions" type="text" placeholder="Newark NJ, Chicago IL, Savannah GA, Houston TX">
        </div>
        <div>
          <label>Mode / Focus</label>
          <select id="mode">
            <option value="both" selected>Both (Ocean + Air)</option>
            <option value="ocean">Ocean (NVOCC/OTI)</option>
            <option value="air">Air (IATA cargo)</option>
          </select>
        </div>
      </div>

      <div class="two" style="margin-top:10px;">
        <div>
          <label>Role Keywords</label>
          <input id="roles" type="text" value="sales, business development, commercial, pricing, account executive">
        </div>
        <div>
          <label>Company Keywords</label>
          <input id="companies" type="text" value="freight forwarder, nvocc, customs broker, logistics, 3pl">
        </div>
      </div>

      <div class="two" style="margin-top:10px;">
        <div>
          <label>Provider</label>
          <select id="provider">
            <option value="serpapi" selected>SerpAPI (Google JSON)</option>
            <option value="tabs">Fallback — Open tabs</option>
          </select>
        </div>
        <div>
          <label>API Key</label>
          <input id="apiKey" type="text" placeholder="(not required — server has key)" disabled>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn" onclick="runSearch()">SEARCH</button>
        <button class="btn secondary" onclick="exportCSV()">Export CSV</button>
        <button class="btn ghost" onclick="saveDefaults()">Save Defaults</button>
        <div class="status" id="status">—</div>
      </div>
    </div>

    <div class="card">
      <h3>Results</h3>
      <table id="resultsTbl">
        <thead><tr><th>#</th><th>Title / Person</th><th>Company / Snippet</th><th>Link</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="footer small">Tip: use official directories to verify licensing (FMC OTI, FIATA, IATA CargoLink, WCAworld).</div>
    </div>

    <div class="card">
      <h3>Quick Directories (open in new tab)</h3>
      <div class="row">
        <a class="pill" href="https://www2.fmc.gov/oti/" target="_blank">FMC OTI</a>
        <a class="pill" href="https://www2.fmc.gov/oti/NVOCC.aspx" target="_blank">FMC NVOCC</a>
        <a class="pill" href="https://www2.fmc.gov/oti/FF.aspx" target="_blank">FMC OFF</a>
        <a class="pill" href="https://fiata.org/directory/us/" target="_blank">FIATA US</a>
        <a class="pill" href="https://www.iata.org/en/publications/directories/cargolink/" target="_blank">IATA CargoLink</a>
        <a class="pill" href="https://www.wcaworld.com/directory" target="_blank">WCAworld</a>
      </div>
    </div>
  </div>

<script>
const state = { rows: [] };

function q(v){ return encodeURIComponent(v.trim()); }
function toast(msg){ document.getElementById('status').textContent = msg; }

function buildQueries(regions, mode, roles, companies){
  const roleTerms = roles.split(',').map(s=>s.trim()).filter(Boolean).join(' OR ');
  const compTerms = companies.split(',').map(s=>s.trim()).filter(Boolean).join(' OR ');
  const modeTerms = mode==='both' ? '(air cargo OR IATA OR ocean freight OR NVOCC OR OTI)' :
                    (mode==='air' ? '(air cargo OR IATA)' : '(ocean freight OR NVOCC OR OTI)');
  const sitesPeople = 'site:linkedin.com/in OR site:rocketreach.co OR site:signalhire.com';
  const sitesCompany = 'site:linkedin.com/company OR site:zoominfo.com OR site:crunchbase.com/organization OR site:owler.com/company';
  const queries = [];
  regions.forEach(r=>{
    const geo = `"${r.trim()}" "United States"`;
    queries.push(`${sitesPeople} (${roleTerms}) (${compTerms}) ${modeTerms} ${geo}`);
    queries.push(`${sitesCompany} (${compTerms}) ${modeTerms} ${geo}`);
  });
  return queries;
}

async function serpApiFetch(apiKey, query, start=0){
  const url = `/api/leads?q=${encodeURIComponent(query)}&start=${start}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('API error: ' + res.status);
  return res.json();
}

function normalizeSerp(results, region){
  const rows = [];
  const items = (results.organic_results||[]);
  items.forEach((it)=>{
    const title = (it.title||'').replace(/\s+\-\s+.*$/,'');
    const link = it.link||'';
    const snippet = it.snippet||'';
    rows.push({
      title,
      company: snippet.substring(0, 200),
      link,
      region,
      provider: 'serpapi'
    });
  });
  return rows;
}

function renderRows(rows){
  const tb = document.querySelector('#resultsTbl tbody');
  tb.innerHTML = '';
  rows.forEach((r,i)=>{
    const tr = document.createElement('tr');
    const linkHtml = r.link ? `<a href="${r.link}" target="_blank">Open</a>` : '';
    tr.innerHTML = `<td class="mono">${i+1}</td>
                    <td>${r.title||''}</td>
                    <td class="small">${r.company||''}</td>
                    <td>${linkHtml}</td>`;
    tb.appendChild(tr);
  });
}

function dedupe(rows){
  const seen = new Set();
  const out = [];
  rows.forEach(r=>{
    const key = (r.link||'').replace(/^https?:\/\//,'').replace(/\/$/,'');
    if(!seen.has(key)){ seen.add(key); out.push(r); }
  });
  return out;
}

async function runSearch(){
  state.rows = [];
  renderRows([]);
  const regions = (document.getElementById('regions').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const roles = document.getElementById('roles').value||'';
  const companies = document.getElementById('companies').value||'';
  const mode = document.getElementById('mode').value;
  const provider = document.getElementById('provider').value;
  const apiKey = document.getElementById('apiKey').value.trim();

  if(regions.length===0){ toast('Enter at least one region (e.g., Newark NJ, Chicago IL)'); return; }

  const queries = buildQueries(regions, mode, roles, companies);
  toast(`Running ${queries.length} queries via ${provider}...`);

  if(provider==='serpapi'){
    if(!apiKey){ toast('Add your SerpAPI key or choose "Fallback — Open tabs".'); return; }
    for(const qy of queries){
      try{
        const j = await serpApiFetch(apiKey, qy);
        const region = regions.find(r => qy.includes(r)) || '';
        state.rows.push(...normalizeSerp(j, region));
      }catch(e){
        console.error(e);
        toast('Error fetching some queries. Check key or rate limits.');
      }
      await new Promise(r=>setTimeout(r, 400)); // gentle pacing
    }
    state.rows = dedupe(state.rows);
    renderRows(state.rows);
    toast(`Found ${state.rows.length} leads (deduped).`);
  } else {
    // Fallback: open searches as tabs (may be blocked by popup blockers)
    queries.forEach(qy => {
      const u = `https://www.google.com/search?q=${encodeURIComponent(qy)}`;
      window.open(u, '_blank');
    });
    toast('Opened queries in new tabs. If nothing opened, allow pop-ups.');
  }
}

function saveDefaults(){
  const data = {
    regions: document.getElementById('regions').value,
    roles: document.getElementById('roles').value,
    companies: document.getElementById('companies').value,
    mode: document.getElementById('mode').value
  };
  localStorage.setItem('moz_lead_pro_defaults', JSON.stringify(data));
  toast('Defaults saved.');
}

(function loadDefaults(){
  const raw = localStorage.getItem('moz_lead_pro_defaults'); if(!raw) return;
  try{
    const d = JSON.parse(raw);
    if(d.regions) document.getElementById('regions').value = d.regions;
    if(d.roles) document.getElementById('roles').value = d.roles;
    if(d.companies) document.getElementById('companies').value = d.companies;
    if(d.mode) document.getElementById('mode').value = d.mode;
  }catch(e){}
})();

function exportCSV(){
  if(!state.rows.length){ toast('No results to export.'); return; }
  const headers = ['Title','Company/Snippet','Link','Region','Provider'];
  const lines = [headers.join(',')];
  state.rows.forEach(r=>{
    const row = [r.title||'', (r.company||'').replace(/[\r\n,]+/g,' '), r.link||'', r.region||'', r.provider||''];
    lines.push(row.map(v => `"${v.replace(/"/g,'""')}"`).join(','));
  });
  const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'mozuluk_leads.csv'; a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
